% $Id: gscomm.tex,v 1.4 2005/12/16 18:11:54 muck Exp $

\documentclass[a4paper,twoside]{article}

\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{ifpdf}
\ifpdf
  \usepackage[pdftex]{epsfig}
\else
  \usepackage[dvips]{epsfig}
\fi
\usepackage{longtable}

\pagestyle{headings}
\textwidth 15.5cm
\textheight 21.5cm
\parindent 10pt
\oddsidemargin 0.55cm
\evensidemargin -0.15cm

%
%  Misc.
%
\def\bm#1{ ${\boldmath$#1$}$ }		% Simple bold math
\def\vec#1{\overrightarrow{#1}}		% Vector
\def\lrep{[\![}				% Representation (left)
\def\rrep{]\!]}				% Representation (right)
\def\rep#1{\lrep#1\rrep}		% Representation

%
%  BNF' Notation
%
\def\bnfpipe{\;\bm{|}\;}
\def\bnfrep#1{\;\bm{(}#1\bm{)}^*}
\def\bnfopt#1{\bm{[}#1\bm{]}}

%
%  Semantics
%
\def\pijl#1{{\stackrel{#1}{\longrightarrow}}}
\def\tick#1{{\stackrel{#1}{\longrightarrow}\checkmark}}
\def\sosrule#1#2{{{\rule{0mm}{6mm} \begin{array}{c} #1\\[0.1ex] \hline \rule{0ex}{2.7ex}#2 \end{array}}}}


%
%  Process operators
%
\def\seq{\cdot}
\def\alt{+}
\def\cond{\rightarrow}
\def\merge{\parallel}
\def\lmerge{\,
                  \setlength{\unitlength}{1ex}
                  \begin{picture}(2.3,2)
                  \thinlines
                  \put(.25,-.57){\line(1,0){1.25}}
                  \put(0,0){$\merge$}
                  \end{picture}
                 \!}
\def\synch{|}

\def\recsol#1#2{\langle #1|#2\rangle}

\def\maction#1{\langle #1\rangle}
\def\mactiong#1{\langle\vec{#1}\rangle}
\def\mactiond#1#2{\langle\vec{#1},\vec{#2}\rangle}
\def\mset#1{[#1]}
\def\msetg#1{[\vec{#1}]}
\def\msetd#1#2{[\vec{#1},\vec{#2}]}
\def\tup#1{\langle #1\rangle}

\def\dom#1{{\it dom}(#1)}
\def\bag#1{\mathbb{B}(#1)}

\def\setma{\boldsymbol{A}}
\def\setan{\mathcal{N}_A}
\def\bagma{\bag{\setma}}
\def\bagan{\bag{\setan}}

\def\booltype{B}
\def\setbool{B_\mathcal{M}}
\def\semtrue{\:t\:}
\def\semfalse{\:f\:}
\def\semneg{\neg}
\def\semor{\lor}
\def\semand{\land}
\def\semimp{\Rightarrow}
\def\sembiimp{\Leftrightarrow}
\def\dtrue{\:\bm{t}\:}
\def\dfalse{\:\bm{f}\:}
\def\dneg{\bm{\neg}\,}
\def\dor{\,\bm{\lor}\,}
\def\dand{\,\bm{\land}\,}
\def\dimp{\,\bm{\Rightarrow}\,}
\def\dbiimp{\,\bm{\Leftrightarrow}\,}
\def\true{\dtrue}	% compatibility def
\def\false{\dfalse}	% compatibility def

\def\ax{\doteq}
\def\axle{\:\dot{\leqslant}\;}
\def\bisim{\underline\leftrightarrow}
\def\bisimle{\:\underline\rightarrow\;}
\def\bisimb{\underline\leftrightarrow_{b}}
\def\bisimrb{\underline\leftrightarrow_{rb}}

\renewcommand{\labelitemii}{$\bullet$}
\renewcommand{\labelitemiii}{$\bullet$}
\renewcommand{\labelitemiv}{$\bullet$}

\newcounter{theoremcnt}[section]
\renewcommand{\thetheoremcnt}{\thesection.\arabic{theoremcnt}}

\newenvironment{Def}%
{\begin{trivlist}\refstepcounter{theoremcnt}
\item[]\bf Definition~\thetheoremcnt.~\rm}{\end{trivlist}}
\newenvironment{Lemma}%
{\begin{trivlist}\refstepcounter{theoremcnt}
\item[]\bf Lemma~\thetheoremcnt.~\rm}{\end{trivlist}}
\newenvironment{Prop}%
{\begin{trivlist}\refstepcounter{theoremcnt}
\item[]\bf Proposition~\thetheoremcnt.~\rm}{\end{trivlist}}
\newenvironment{Thrm}%
{\begin{trivlist}\refstepcounter{theoremcnt}
\item[]\bf Theorem~\thetheoremcnt.~\rm}{\end{trivlist}}
\newenvironment{Proof}%
{\begin{trivlist}\item[]\bf Proof~\thetheoremcnt.~\rm}{\hfill$\Box$\end{trivlist}}
\newenvironment{corollary}%
{\begin{trivlist}\refstepcounter{theoremcnt}
\item[]\bf Corollary~\thetheoremcnt.~\rm}{\end{trivlist}}

\newenvironment{definition}
{\par\addtolength{\baselineskip}{6mm}\begin{array}{lll}}{\end{array}$}
\newcommand{\defitem}[2]{#1 & = & #2 \\}

\newenvironment{derivation}
{\par\addtolength{\baselineskip}{1mm}\begin{tabbing}\hspace{5mm}\=\hspace{5mm}\=\hspace{5mm}\=\kill}{\end{tabbing}}
\newcommand{\expr}[1]{\>\>$#1$}
\newcommand{\tran}[2]{\\*\>$#1$\>\>\{ #2 \}\\}
\newcommand{\breakexpr}{$\\*\>\>$}
\newcommand{\breaktran}{\\*\>\>\>\hspace{8pt}}

\def\nocount{\addtocounter{table}{-1}}

%------------------------------   FILE gcl.tex ----------------------------------
\newenvironment{GCL}%
{\begin{trivlist}\item[]\hspace{4mm}}{\end{trivlist}}
\newcommand{\gprog}[1]{\begin{tabular}[t]{@{\hspace{0mm}}l@{\hspace{0mm}}l@{\hspace{0mm}}l@{\hspace{2mm}}l}&&$|[$&$#1$\\&&$]|$&\\\end{tabular}}
\newcommand{\gprogvar}[2]{\begin{tabular}[t]{@{\hspace{0mm}}l@{\hspace{0mm}}l@{\hspace{0mm}}l@{\hspace{2mm}}l}&&$|[$&$#1$\\&&$|$&$#2$\\&&$]|$&\\\end{tabular}}
\newcommand{\gconst}{{\bf const}\;}
\newcommand{\gvar}{{\bf var}\;}
\newcommand{\gdecl}[2]{#1: #2;\;}
\newcommand{\garray}{{\bf array}\;}
\newcommand{\glist}{{\bf list}\;}
\newcommand{\grange}[2]{[#1..#2)\;}
\newcommand{\gof}{{\bf of\;}}
\newcommand{\gint}{{\bf int}}
\newcommand{\gbool}{{\bf bool}}
\newcommand{\gnl}{$\\&&&$}
\newcommand{\gpar}{$\\&&$||$&$}
\newcommand{\gassert}[1]{\{\;$#1$\;\}}
\newcommand{\gseq}{$\\&&$;$&$}
\newcommand{\gassign}[2]{#1:=#2}
\newcommand{\greturn}[1]{{\bf return}\;#1}
\newcommand{\gskip}{{\bf skip}}
\newcommand{\gif}[2]{$\begin{tabular}[t]{@{\hspace{0mm}}l@{\hspace{2mm}}l@{\hspace{2mm}}r@{\hspace{2mm}}l@{\hspace{0mm}}}${\bf if}$&$#1$&$\rightarrow$&$#2$\\\end{tabular}\\&&&${\bf fi}}
\newcommand{\gifalt}[2]{$\\$[\!]$&$#1$&$\rightarrow$&$#2}
\newcommand{\gdo}[2]{$\begin{tabular}[t]{@{\hspace{0mm}}l@{\hspace{2mm}}l@{\hspace{2mm}}r@{\hspace{2mm}}l@{\hspace{0mm}}}${\bf do}$&$#1$&$\rightarrow$&$#2$\\\end{tabular}\\&&&${\bf od}}
\newcommand{\gdoalt}[2]{$\\$[\!]$&$#1$&$\rightarrow$&$#2}
%------------------------------ END FILE gcl.tex ----------------------------------

\begin{document}

\title{{\bf Calculation of Communication with Open Terms}\\\large in GenSpect Process Algebra\\\footnotesize (Draft)}
\author{Muck van Weerdenburg\\\footnotesize M.J.v.Weerdenburg@student.tue.nl}
\date{\footnotesize\today}
\maketitle

\noindent We recall the definition of the communication function $\gamma$ of \cite{thesis_gpa}.

\begin{Def}
Let $m\in\bagma$ and $a\in\mathcal{N}_A$. Also, let $\vec{d},\vec{e}\in\vec{D_\mathcal{M}}$. The function $\chi: \bagma\times\vec{D_\mathcal{M}}\rightarrow B$ is true if, and only if, all actions of the multiaction parameter have the given data vector as parameter, i.e. $\chi$ is defined as follows:
\begin{center}$\begin{array}{llll}
\chi([],\vec{d})&=&t \\
\chi([a(\vec{e})]\oplus m,\vec{d})&=&\chi(m,\vec{d})&\;\;\;{\it if}\;\vec{d}=\vec{e} \\
\chi([a(\vec{e})]\oplus m,\vec{d})&=&f&\;\;\;{\it if}\;\vec{d}\not=\vec{e} \\
\end{array}$\end{center}
\end{Def}

\begin{Def}\label{original_gamma}
Let $N_\mathbb{B}=\{n\;|\;n\in\bagan\land 1<|n|\}$, $a(\vec{d})\in \bm{A}$, $b\in N_\mathbb{B}$ and $m,n,o\in\bagma$. Also let $C: N_\mathbb{B}\rightarrow (\mathcal{N}_A\cup\{\tau\})$ with $\forall_{\tup{b,a},\tup{c,a}\in C}(\forall_{n\in b}(n\not\in c))$. The {\em communication} function $\gamma: \bagma\times(N_\mathbb{B}\rightarrow (\mathcal{N}_A\cup\{\tau\}))\rightarrow\bagma$ is defined by the following definition:
\begin{center}$\begin{array}{llll}
\gamma(m\oplus n,C) & = & \mset{a(\vec{d})}\oplus\gamma(n,C) & \exists_{\langle b,a\rangle\in C}(b=\mu(m)\land \chi(m,\vec{d})) \\
\gamma(m\oplus n,C) & = & \gamma(n,C) & \exists_{\langle b,\tau\rangle\in C}(b=\mu(m)\land \chi(m,\vec{d})) \\
\gamma(m,C) & = & m & \neg\exists_{n,o}(m=n\oplus o\land\exists_{c\in C}((c=\langle b,a\rangle\lor c=\langle b,\tau\rangle)\land b=\mu(n)\land\\&&&\hspace{45mm}\exists_{\vec{d}\in\vec{D}}(\chi(n,\vec{d})))) \\
\end{array}$\end{center}
\end{Def}

\noindent When working with open terms one encounters the problem that we may not be able to calculate the value of $\chi(m,\vec{d})$. As we wish to calculate the possible communications of a certain multiaction, given some communication function, the result will have to be a set of tuples containing a multiaction resulting from communication and a condition, with terms $\chi(m,\vec{d})$, indicating what must hold for this communication to be possible.

But first we reformulate $\gamma$ to $\gamma'$ as follows, because Definition \ref{original_gamma} is not really suitable from a implementation point of view. Note that we somewhat ignore the possibility of right hand sides that are $\tau$, but this is not directly relevant for the algorithms. If one desires, one can consider $\mset{\tau(\vec{d})}$ to be equal to $\mset{}$ to make things fit.

\begin{Def}\label{new_gamma}
Let $N_\mathbb{B}=\{n\;|\;n\in\bagan\land 1<|n|\}$, $a(\vec{d})\in \bm{A}$, $b\in N_\mathbb{B}$ and $m,n,o\in\bagma$. Also let $C: N_\mathbb{B}\rightarrow (\mathcal{N}_A\cup\{\tau\})$ with $\forall_{\tup{b,a},\tup{c,a}\in C}(\forall_{n\in b}(n\not\in c))$. The {\em communication} function $\gamma: \bagma\times(N_\mathbb{B}\rightarrow (\mathcal{N}_A\cup\{\tau\}))\rightarrow\bagma$ is defined by the following definition:
\begin{center}$\begin{array}{llll}
\gamma'(\mset{},C) & = & \mset{} \\
\gamma'(\mset{a(\vec{d})}\oplus m,C) & = & \mset{a(\vec{d})}\oplus\gamma'(m,C) & \neg\exists_{n,o,\langle b,c\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land \chi(n,\vec{d}))\\
\gamma'(\mset{a(\vec{d})}\oplus m,C) & = & \mset{c(\vec{d})}\oplus\gamma'(o,C) & \exists_{n,\langle b,c\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land \chi(n,\vec{d})) \\
\end{array}$\end{center}
\end{Def}

\begin{Lemma}
Definition \ref{original_gamma} and \ref{new_gamma} define equivalent functions. That is, $\gamma(m,C)=\gamma'(m,C)$, for all $m$ and $C$.
\end{Lemma}

\begin{Proof}
The defining equations of $\gamma'$ are complete, so we only need to show that $\gamma'$ is sound (with respect to $\gamma$). We do this by induction on $m$.
\\\\
Case $[]$:
\\\\
$\begin{array}{ll}
& \gamma'(\mset{},C) \\
= & \mset{} \\
= & \gamma(\mset{},C) \\
\end{array}$
\\\\\\
Case $\mset{a(\vec{d})}\oplus m$. We do case distinction on the possibility of $a(\vec{d})$ to participate in a communication. Case $\exists_{n,\langle b,a\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land \chi(n,\vec{d}))$:
\\\\
$\begin{array}{ll}
& \gamma'(\mset{a(\vec{d})}\oplus m,C) \\
= & \mset{a(\vec{d})}\oplus\gamma'(o,C) \\
= & \mset{c(\vec{d})}\oplus\gamma(o,C) \\
= & \gamma((\mset{a(\vec{d})}\oplus n)\oplus o,C) \\
= & \gamma(\mset{a(\vec{d})}\oplus (n\oplus o),C) \\
= & \gamma(\mset{a(\vec{d})}\oplus m,C) \\
\end{array}$
\\\\\\
Case $\neg\exists_{n,o,\langle b,a\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land \chi(n,\vec{d}))$, with $m'$ and $m''$ such that $\gamma(m,C)=m''\oplus\gamma(m',C)$ and $\gamma(m',C)=m'$:
\\\\
$\begin{array}{ll}
& \gamma'(\mset{a(\vec{d})}\oplus m,C) \\
= & \mset{a(\vec{d})}\oplus\gamma'(m,C) \\
= & \mset{a(\vec{d})}\oplus\gamma(m,C) \\
= & \mset{a(\vec{d})}\oplus m''\oplus\gamma(m',C) \\
= & \mset{a(\vec{d})}\oplus m''\oplus m' \\
= & m''\oplus \mset{a(\vec{d})}\oplus m' \\
= & m''\oplus \gamma(\mset{a(\vec{d})}\oplus m',C) \\
= & \gamma(\mset{a(\vec{d})}\oplus m,C) \\
\end{array}$
\\\\\\
\end{Proof}

\noindent Taking as basis the new definition, we now define the function we are really interested in. That is, the communication function on open terms. We use the set $T_{\mathbb{B}}$ of (open) boolean terms and assume that expression depending on action arguments $\vec{d}$ are such terms.

\def\bagmao{\bag{\bm{A'}}}
\begin{Def}
Let $\bagmao$ be the set of bags of actions with open data parameters. The extension of the communication operator over open data terms $\overline{\gamma}(m,C): \bagmao\times(N_{\mathbb{B}}\rightarrow(\mathcal{N}_{\mathcal{A}}\cup\{\tau\}))\rightarrow\mathcal{P}(\bagmao\times T_{\mathbb{B}})$ is defined as follows.
\begin{center}$\begin{array}{lll}
\overline{\gamma}(\mset{},C) & = & \{\tup{\mset{},{\it true}}\} \\
\overline{\gamma}(\mset{a(\vec{d})}\oplus m,C) & = & \{\tup{r,e}\;|\;\exists_{n,o,\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o,c)}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\\&&\hspace{15mm}(e=\chi(n,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \;\;\cup\\&& \{\tup{\mset{a(\vec{d})}\oplus r,e\land\neg\exists_{n,o,\langle b,c\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\\&&\hspace{15mm} \chi(n,\vec{d}))}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\}\\
\end{array}$\end{center}
\end{Def}

\begin{Thrm}
Let $m\in\bagmao$ and $\sigma$ an assignment of variables to closed terms. Then the following holds:
\begin{center}$\forall_{\tup{r,e}\in\overline{\gamma}(m,C)}(e\sigma\;\Rightarrow\; r\sigma = \gamma(m,C))$\end{center}
\end{Thrm}

\noindent Note that we can rewrite $\neg\exists_{n,o,\langle b,c\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\chi(n,\vec{d}))$ as follows.

\begin{center}$\begin{array}{ll}
& \neg\exists_{n,o,\langle b,c\rangle\in C}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\chi(n,\vec{d})) \\
\equiv & \forall_{n,o,\langle b,c\rangle\in C}(\neg(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\chi(n,\vec{d}))) \\
\equiv & \forall_{n,o,\langle b,c\rangle\in C}(\neg(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n))\lor\neg\chi(n,\vec{d}))) \\
\equiv & \forall_{n,o,\langle b,c\rangle\in C}((m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n))\Rightarrow\neg\chi(n,\vec{d}))) \\
\end{array}$\end{center}

\begin{Def}
\begin{center}$\begin{array}{lll}
\overline{\gamma}'(\mset{},C) & = & \{\tup{\mset{},{\it true}}\} \\
\overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C) & = & \{\tup{r,e}\;|\;\exists_{n,o,\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o,c)}(m=n\oplus o\land b=\mu(\mset{a(\vec{d})}\oplus n)\land\\&&\hspace{15mm}(e=\chi(n,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\}\\
\end{array}$\end{center}
\end{Def}

\begin{Lemma}
\begin{center}$\overline{\gamma}(\mset{a(\vec{d})}\oplus m,C)=\overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C)\cup\{\tup{\mset{a(\vec{d})}\oplus r,e\land\forall_{\tup{r',e'}\in\overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C)}(\neg e')}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\}$\end{center}
\end{Lemma}

\noindent We now concentrate on $\overline{\gamma}'$.

\begin{Def}
\begin{center}$\begin{array}{lll}
\phi(m,\vec{d},w,n,C) & = & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(n=o\oplus o'\land b=\mu(m \oplus o)\land\\&&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
\end{array}$\end{center}
\end{Def}

\begin{Lemma}
$\overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C)=\phi(\mset{a(\vec{d})},\vec{d},\mset{},m,C)$
\end{Lemma}

And finally with $\phi$:

\begin{center}$\begin{array}{ll}
& \phi(m,\vec{d},w,\mset{},C) \\
= & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(\mset{}=o\oplus o'\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(\mset{}\oplus w,C)}(b=\mu(m \oplus \mset{})\land\\&\hspace{15mm}(e=\chi(\mset{},\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{\langle b,c\rangle\in C,\tup{r',e'}\in\overline{\gamma}(w,C)}(b=\mu(m)\land e=e' \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{\mset{c(\vec{d})}\oplus r',e'}\;|\;\exists_{\langle b,c\rangle\in C}(b=\mu(m))\land \tup{r',e'}\in\overline{\gamma}(w,C)\} \\
\end{array}$\end{center}

\begin{center}$\begin{array}{ll}
& \phi(m,\vec{d},w,\mset{a(\vec{f})}\oplus n,C) \\
= & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o',C)}(\mset{a(\vec{f})}\oplus n=o\oplus o'\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
\end{array}$\end{center}

\noindent Here $a(\vec{d})$ can be in $o$ or in $o'$. Assume it is in $o$.

\begin{center}$\begin{array}{ll}
 & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(\mset{a(\vec{f})}\oplus n=o\oplus o'\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(n=(o\ominus \mset{a(\vec{f})})\oplus o'\land b=\mu(m \oplus\mset{a(\vec{f})}\oplus (o\ominus \mset{a(\vec{f})}))\land\\&\hspace{15mm}(e=\chi(\mset{a(\vec{f})}\oplus(o\ominus\mset{a(\vec{f})}),\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{o'',o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(n=o''\oplus o'\land b=\mu(m \oplus\mset{a(\vec{f})}\oplus o'')\land\\&\hspace{15mm}(e=(\vec{f}=\vec{d})\land\chi(o'',\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e\land(\vec{f}=\vec{d})}\;|\;\exists_{o'',o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(n=o''\oplus o'\land b=\mu(m \oplus\mset{a(\vec{f})}\oplus o'')\land\\&\hspace{15mm}(e=\chi(o'',\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e\land(\vec{f}=\vec{d})}\;|\;\tup{r,e}\in\phi(m\oplus\mset{a(\vec{f})},\vec{d},w,n,C)\} \\
\end{array}$\end{center}

\noindent Now assume it is in $o'$.

\begin{center}$\begin{array}{ll}
 & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(o'\oplus w,C)}(\mset{a(\vec{f})}\oplus n=o\oplus o'\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(\mset{a(\vec{f})}\oplus (o'\ominus \mset{a(\vec{f})})\oplus w,C)}(n=o\oplus (o'\ominus \mset{a(\vec{f})})\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \{\tup{r,e}\;|\;\exists_{o,o',\langle b,a\rangle\in C,\tup{r',e'}\in\overline{\gamma}(\mset{a(\vec{f})}\oplus o'\oplus w,C)}(n=o\oplus o')\land b=\mu(m \oplus o)\land\\&\hspace{15mm}(e=\chi(o,\vec{d})\land e') \land r=\mset{c(\vec{d})}\oplus r')\} \\
= & \phi(m,\vec{d},w\oplus \mset{a(\vec{f})},n,C) \\
\end{array}$\end{center}

\noindent To conclude, we write an algorithm that uses what we have proven.

\begin{GCL}
$\overline{\gamma}(m,C)=$
\gprogvar{
  \gvar
  \gdecl{S,T}{\mathcal{P}(\bagmao\times T_{\mathbb{B}})}
  \gvar
  \gdecl{b}{T_{\mathbb{B}}}
}{
  \gnl
  \gif{m=\mset{}}{
    \gassign{S}{\{\tup{\mset{},{\it true}}\}}
  \gifalt{m=\mset{a(\vec{d})}\oplus n}{
    \gassign{S,T}{\phi(\mset{a(\vec{d})},\vec{d},\mset{},n,C),\overline{\gamma}(n,C)}\gseq
    \gassign{b}{\forall_{\tup{r,e}\in S}(\neg e)}\gseq
    \gassign{S}{S\cup\{\tup{\mset{a(\vec{d})}\oplus r,e\land b}\;|\;\tup{r,e}\in T\}}
  }}\gseq
  \greturn{S}
}
\end{GCL}

\begin{GCL}
$\phi(m,\vec{d},w,n,C)=$
\gprogvar{
  \gvar
  \gdecl{S,T}{\mathcal{P}(\bagmao\times T_{\mathbb{B}})}
}{
  \gnl
  \gif{n=\mset{}}{
    \gif{\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{T}{\overline{\gamma}(w,C)}\gseq
      \gassign{S}{\{\tup{\mset{c(\vec{d})}\oplus r,e}\;|\;\tup{r,e}\in T\}}
    \gifalt{\neg\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{S}{\emptyset}
    }}
  \gifalt{n=\mset{a(\vec{f})}\oplus o}{
    \gassign{T}{\phi(m\oplus\mset{a(\vec{f})},\vec{d},w,o,C)}\gseq
    \gassign{T}{\{\tup{r,e\land(\vec{f}=\vec{d})}\;|\;\tup{r,e}\in T\}}\gseq
    \gassign{S}{T\cup\phi(m,\vec{d},w\oplus\mset{a(\vec{f})},o,C)}
  }}\gseq
  \greturn{S}
}
\end{GCL}

\noindent If we analyse this algorithm focussing on the lenght of input $m$, we see that it is $O(2^{|m|})$. It basically takes the first action in $m$ and computes the result given that this action participates in a communication and the result given that it does not.

However, looking at $\phi$, we can see that the algorithm needlessly tries to find a part in $n$, such that $m$ with this part can communicate, if $m$ is not even a subbag of a left hand side of a communication in $C$. So, we propose to add an extra check to $\phi$ to prevent this behaviour and making the algorithm more (or precisely) in the order of $O(2^{|m_1|}+|m_2|)$, with $m=m_1\oplus m_2$ and $m_1$ contains actions that occur in a left hand side of a communication in C and $m_2$ actions that do not.

\begin{GCL}
$\phi(m,\vec{d},w,n,C)=$
\gprogvar{
  \gvar
  \gdecl{S,T}{\mathcal{P}(\bagmao\times T_{\mathbb{B}})}
  \gnl
  \gvar
  \gdecl{b}{\gbool}
}{
  \gnl
  \gassign{b}{\exists_{o,c}(\tup{\mu(m)\oplus o,c}\in C)}
  \gseq
  \gif{\neg b}{
    \gassign{S}{\emptyset}
  \gifalt{b\land n=\mset{}}{
    \gif{\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{T}{\overline{\gamma}(w,C)}\gseq
      \gassign{S}{\{\tup{\mset{c(\vec{d})}\oplus r,e}\;|\;\tup{r,e}\in T\}}
    \gifalt{\neg\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{S}{\emptyset}
    }}
  \gifalt{b\land n=\mset{a(\vec{f})}\oplus o}{
    \gassign{T}{\phi(m\oplus\mset{a(\vec{f})},\vec{d},w,o,C)}\gseq
    \gassign{T}{\{\tup{r,e\land(\vec{f}=\vec{d})}\;|\;\tup{r,e}\in T\}}\gseq
    \gassign{S}{T\cup\phi(m,\vec{d},w\oplus\mset{a(\vec{f})},o,C)}
  }}}\gseq
  \greturn{S}
}
\end{GCL}

\noindent 
Another problem with the above code is that it can generate a lot of negative conditions to indicate that certain communication do not happen. This appears to be at least exponential.

We solve this by removing the problematic $\forall$ in $\overline{\gamma}$. Instead we add an extra parameter to $\overline{\gamma}$ and $\phi$ indicating which actions will not communicate. Then, in the final case of $\overline{\gamma}$, where $m=\mset{}$, we use a new function $\psi$ to calculate a more reasonable condition indicating that the remaining actions do not communicate.

Note that the following algorithm deviates in a significant way of the previous version, which means that it validity is not guaranteed and additional proofs will be needed.

\begin{GCL}
$\overline{\gamma}(m,C,r)=$
\gprogvar{
  \gvar
  \gdecl{S,T}{\mathcal{P}(\bagmao\times T_{\mathbb{B}})}
}{
  \gnl
  \gif{m=\mset{}}{
    \gassign{S}{\{\tup{r,\psi(r,C)}\}}
  \gifalt{m=\mset{a(\vec{d})}\oplus n}{
    \gassign{S,T}{\phi(\mset{a(\vec{d})},\vec{d},\mset{},n,C,r),\overline{\gamma}(n,C,\mset{a(\vec{d})}\oplus r)}\gseq
    \gassign{S}{S\cup T}
  }}\gseq
  \greturn{S}
}
\end{GCL}

\begin{GCL}
$\phi(m,\vec{d},w,n,C,r)=$
\gprogvar{
  \gvar
  \gdecl{S,T}{\mathcal{P}(\bagmao\times T_{\mathbb{B}})}
  \gnl
  \gvar
  \gdecl{b}{\gbool}
}{
  \gnl
  \gassign{b}{\exists_{o,c}(\tup{\mu(m)\oplus o,c}\in C)}
  \gseq
  \gif{\neg b}{
    \gassign{S}{\emptyset}
  \gifalt{b\land n=\mset{}}{
    \gif{\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{T}{\overline{\gamma}(w,C,r)}\gseq
      \gassign{S}{\{\tup{\mset{c(\vec{d})}\oplus r,e}\;|\;\tup{r,e}\in T\}}
    \gifalt{\neg\exists_{\tup{b,c}\in C}(b=\mu(m))}{
      \gassign{S}{\emptyset}
    }}
  \gifalt{b\land n=\mset{a(\vec{f})}\oplus o}{
    \gassign{T}{\phi(m\oplus\mset{a(\vec{f})},\vec{d},w,o,C,r)}\gseq
    \gassign{T}{\{\tup{r,e\land(\vec{f}=\vec{d})}\;|\;\tup{r,e}\in T\}}\gseq
    \gassign{S}{T\cup\phi(m,\vec{d},w\oplus\mset{a(\vec{f})},o,C,r)}
  }}}\gseq
  \greturn{S}
}
\end{GCL}

\begin{GCL}
$\psi(m,C)=$
\gprogvar{
  \gvar
  \gdecl{b}{T_{\mathbb{B}}}
}{
  \gnl
  \gif{m=\mset{}}{
    \gassign{b}{\mathit{true}}
  \gifalt{m=\mset{a(\vec{d})}\oplus n}{
    \gassign{b}{\psi'(a(\vec{d}),n,C)\land\psi(n,C)}
  }}\gseq
  \greturn{b}
}
\end{GCL}

\begin{GCL}
$\psi'(a(\vec{d}),m,C)=$
\gprogvar{
  \gvar
  \gdecl{b}{T_{\mathbb{B}}}
  \gnl
  \gvar
  \gdecl{c}{\gbool}
}{
  \gnl
  \gif{m=\mset{}}{
    \gassign{b}{\mathit{true}}
  \gifalt{m=\mset{b(\vec{e})}\oplus n}{
    \gassign{c}{\exists_{o,d}(\tup{\mset{a,b}\oplus o,d}\in C)}
    \gseq
    \gif{c \land \xi(\mset{a(\vec{d}),b(\vec{e})},n,C)}{
      \gassign{b}{\psi'(a(\vec{d}),n,C)\land (\vec{d}\not=\vec{e})}
    \gifalt{\neg c \lor \neg\xi(\mset{a(\vec{d}),b(\vec{e})},n,C)}{
      \gassign{b}{\psi'(a(\vec{d}),n,C)}
    }}
  }}\gseq
  \greturn{b}
}
\end{GCL}

\begin{GCL}
$\xi(m,n,C)=$
\gprogvar{
  \gvar
  \gdecl{b}{\gbool}
}{
  \gnl
  \gif{n=\mset{}}{
    \gassign{b}{\exists_{d}(\tup{m,d}\in C)}
  \gifalt{n=\mset{a(\vec{d})}\oplus o}{
    \gif{\exists_{d}(\tup{\mset{a}\oplus m,d}\in C)}{
       \gassign{b}{\mathit{true}}
    \gifalt{\exists_{b,o',d}(\tup{\mset{a,b}\oplus m\oplus o',d}\in C)}{
       \gassign{b}{\xi(\mset{a}\oplus m,o,C) \lor \xi(m,o,C)}
    \gifalt{\neg\exists_{o',d}(\tup{[a]\oplus m\oplus o',d}\in C)}{
       \gassign{b}{\xi(m,o,C)}
    }}}
  }}\gseq
  \greturn{b}
}
\end{GCL}

\noindent
Naturally, functions $\psi$ and $\psi'$ can easily be transformed to the following non-recursive implementation.

\begin{GCL}
$\psi(m,C)=$
\gprogvar{
  \gvar
  \gdecl{b}{T_{\mathbb{B}}}
}{
  \gnl
  \gassign{b}{\mathit{true}}
  \gseq
  \gdo{m=\mset{a(\vec{d})}\oplus n}{
    \gassign{b,m}{b\land\psi'(a(\vec{d}),n,C),n}
  }
  \gseq
  \greturn{b}
}
\end{GCL}

\begin{GCL}
$\psi'(a(\vec{d}),m,C)=$
\gprogvar{
  \gvar
  \gdecl{b}{T_{\mathbb{B}}}
  \gnl
  \gvar
  \gdecl{c}{\gbool}
}{
  \gnl
  \gassign{b}{\mathit{true}}
  \gseq
  \gdo{m=\mset{b(\vec{e})}\oplus n}{
    \gassign{c}{\exists_{o,d}(\tup{\mset{a,b}\oplus o,d}\in C)}
    \gseq
    \gif{c \land \xi(\mset{a(\vec{d}),b(\vec{e})},n,C)}{
      \gassign{b}{b \land (\vec{d}\not=\vec{e})}
    \gifalt{\neg c \lor \neg\xi(\mset{a(\vec{d}),b(\vec{e})},n,C)}{
      \gskip
    }}
    \gseq
    \gassign{m}{n}
  }
  \gseq
  \greturn{b}
}
\end{GCL}

\begin{Thrm}
\[ \overline{\gamma}(m,C,r) = \{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \} \]
\end{Thrm}

\begin{Proof}
\begin{derivation}
\expr{\{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \overline{\gamma}([],C) \}}
\tran{=}{}
\expr{\{ \tup{ r\oplus r' ,  e \land \psi(r,C) } \;:\; \tup{r',e} \in \{ \tup{[]}{\mathit{true}} \} \}}
\tran{=}{}
\expr{\{ \tup{ r\oplus [] , \mathit{true} \land \psi(r,C) } \}}
\tran{=}{}
\expr{\{ \tup{ r , \psi(r,C) } \}}
\tran{=}{}
\expr{\overline{\gamma}([],C,r)}
\end{derivation}
\begin{derivation}
\expr{\{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \overline{\gamma}([a(\vec{d})]\oplus m,C) \}}
\tran{=}{}
\expr{\{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C)\cup\{\tup{\mset{a(\vec{d})}\oplus r,e\land\forall_{\tup{r',e'}\in\overline{\gamma}'(\mset{a(\vec{d})}\oplus m,C)}(\neg e')}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\} \}}
\tran{=}{}
\expr{\{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \phi(\mset{a(\vec{d})},\vec{d},[],m,C)\cup\{\tup{\mset{a(\vec{d})}\oplus r,e\land\forall_{\tup{r',e'}\in\phi(\mset{a(\vec{d})},\vec{d},[],m,C)}(\neg e')}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\} \}}
\tran{=}{}
\expr{\{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \phi(\mset{a(\vec{d})},\vec{d},[],m,C) \} \cup \{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \{\tup{\mset{a(\vec{d})}\oplus r,e\land\forall_{\tup{r',e'}\in\phi(\mset{a(\vec{d})},\vec{d},[],m,C)}(\neg e')}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\} \}}
\tran{=}{}
\expr{\phi(\mset{a(\vec{d})},\vec{d},[],m,C,r) \cup \{ \tup{ r\oplus r' , e \land \psi(r,C) } \;:\; \tup{r',e} \in \{\tup{\mset{a(\vec{d})}\oplus r,e\land\forall_{\tup{r',e'}\in\phi(\mset{a(\vec{d})},\vec{d},[],m,C)}(\neg e')}\;|\;\tup{r,e}\in\overline{\gamma}(m,C)\} \}}
\tran{=}{}
\expr{\phi(\mset{a(\vec{d})},\vec{d},[],m,C,r) \cup \{ \tup{ r\oplus \mset{a(\vec{d})}\oplus r' , e \land \forall_{\tup{r',e'}\in\phi(\mset{a(\vec{d})},\vec{d},[],m,C)}(\neg e') \land \psi(r,C) } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \}}
\tran{=}{X}
\expr{\phi(\mset{a(\vec{d})},\vec{d},[],m,C,r) \cup \{ \tup{ \mset{a(\vec{d})}\oplus r\oplus r' , e \land \psi(\mset{a(\vec{d})}\oplus r,C) } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \}}
\tran{=}{}
\expr{\phi(\mset{a(\vec{d})},\vec{d},[],m,C,r) \cup \overline{\gamma}(m,C,[a(\vec{d})]\oplus r)}
\tran{=}{}
\expr{\overline{\gamma}([a(\vec{d})]\oplus m,C,r)}
\end{derivation}
\end{Proof}

\begin{corollary}
\[ \overline{\gamma}(m,C) = \overline{\gamma}(m,C,[]) \]
\end{corollary}

\begin{Proof}
\begin{derivation}
\expr{\overline{\gamma}(m,C,[])}
\tran{=}{}
\expr{\{ \tup{ []\oplus r' , e \land \psi([],C) } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \}}
\tran{=}{}
\expr{\{ \tup{ r' , e \land \mathit{true} } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \}}
\tran{=}{}
\expr{\{ \tup{ r' , e } \;:\; \tup{r',e} \in \overline{\gamma}(m,C) \}}
\tran{=}{}
\expr{\overline{\gamma}(m,C)}
\end{derivation}
\end{Proof}


\begin{thebibliography}{99}
\bibitem{thesis_gpa}M.J. van Weerdenburg, {\it GenSpect Process Algebra}, Master's thesis, Eindhoven University of Technology, 2004
\end{thebibliography}

\end{document} 
